import{Octokit as e}from"https://cdn.skypack.dev/@octokit/core";const t=document.querySelector("#sidenav-open"),n=document.querySelector("#sidenav-close"),d=document.querySelector("#sidenav-button");function o(e){i.textContent=e}function a(e){g.value=e}function s(){return document.getElementById("git-message").value}function r(e){document.getElementById("git-message").value=e}t.addEventListener("transitionend",(e=>{if("transform"!==e.propertyName)return;const t="#sidenav-open"===document.location.hash;t?n.focus():d.focus(),t||history.replaceState(history.state,"")})),t.addEventListener("keyup",(e=>{"Escape"===e.code&&(window.history.length?window.history.back():document.location.hash="")}));const i=document.getElementById("main-title"),c=document.getElementById("notification"),l=document.querySelector("#git-directory-path"),u=document.getElementById("content-path"),m=document.getElementById("directory"),h=document.getElementById("newfilename"),g=document.getElementById("blog-area"),v=document.getElementById("blog-preview"),p=document.getElementById("directory-btn"),y=document.getElementById("directory-btn-new"),L=document.getElementById("edit-btn"),E=document.getElementById("preview-btn");var f=null,w=null,I=null,b=null,B=null,q=null;function S(){"#sidenav-open"===document.location.hash?window.history.back():document.location.hash=""}function k(){directory.innerHTML="Loading...";var e={owner:b,repo:B,path:u.value};q.request("GET /repos/{owner}/{repo}/contents/{path}",e).then((e=>{var t;directory.innerHTML="",t=u.value,l.textContent=t;var n=y.content.cloneNode(!0),d=n.querySelector("button");d.dataset.path=u.value,n.querySelector("span").textContent="Write new ",m.append(n),d.addEventListener("click",(e=>{T("hidden",""),S(),a(""),w="",f="",i.classList.add("hidden"),h.classList.remove("hidden"),L.classList.add("hidden"),E.classList.remove("hidden")})),e.data.map((e=>{var t=p.content.cloneNode(!0),n=t.querySelector("button");n.dataset.path=e.path,n.dataset.sha=e.sha,n.dataset.name=e.name,t.querySelector("span").textContent=e.name,n.addEventListener("click",(e=>{T("hidden",""),S(),i.classList.remove("hidden"),h.classList.add("hidden"),L.classList.add("hidden"),E.classList.remove("hidden"),o(e.target.dataset.name),f=e.target.dataset.path,w=e.target.dataset.sha,async function(e){var t={owner:b,repo:B,path:e};const n=await q.request("GET /repos/{owner}/{repo}/contents/{path}",t);return{sha:n.data.sha,content:n.data.content}}(e.target.dataset.path).then((e=>{a(atob(e.content))}))})),m.append(t)}))}))}function T(e,t){c.classList.remove(...c.classList),c.classList.add(e),c.textContent=t}h.addEventListener("change",(e=>{f=u.value+"/"+e.target.value})),document.getElementById("publish-btn").addEventListener("click",(e=>{T("hidden","");const t=s();if(!t)return void T("error","Git commit message is empty");if(!f)return void T("error","There is no file path selected");const n=btoa(g.value);var d={owner:b,repo:B,path:f,message:t,content:n};w&&(d.sha=w),q.request("PUT /repos/{owner}/{repo}/contents/{path}",d).then((e=>{w=e.data.content.sha,T("success","Content committed to github, hurray!"),r(""),console.log(e)})).catch((e=>{T("error","Error during API call."),console.log(e)}))})),document.getElementById("delete-btn").addEventListener("click",(e=>{T("hidden","");const t=s();if(t)if(f)if(w){var n={owner:b,repo:B,path:f,message:t,sha:w};q.request("DELETE /repos/{owner}/{repo}/contents/{path}",n).then((e=>{w="",T("success","Content has been deleted from repository!"),o(""),a(""),r("")})).catch((e=>{T("error","Error during API call."),console.log(e)}))}else T("error","This file has no SHA, cannot be deleted.");else T("error","There is no file path selected");else T("error","Git commit message is empty")})),document.getElementById("sign-in").addEventListener("click",(t=>{b=document.getElementById("git-owner").value,B=document.getElementById("git-repository").value,I=document.getElementById("git-auth").value,b&&B&&I?(T("hidden",""),q=new e({auth:I}),o(""),a(""),document.querySelector("#login-form").classList.add("hidden"),document.querySelector("#path-loader").classList.remove("hidden"),document.querySelector("#blog-container").classList.remove("hidden"),d.classList.remove("hidden"),m.classList.remove("hidden"),k()):T("error","You missed to enter something...")})),document.getElementById("load-gitdir-btn").addEventListener("click",(e=>{S(),o("Sign in"),document.getElementById("git-auth").value=I,document.querySelector("#login-form").classList.remove("hidden"),document.querySelector("#path-loader").classList.add("hidden"),document.querySelector("#blog-container").classList.add("hidden"),d.classList.add("hidden"),m.classList.add("hidden")})),L.addEventListener("click",(e=>{v.classList.add("hidden"),g.classList.remove("hidden"),L.classList.add("hidden"),E.classList.remove("hidden")})),E.addEventListener("click",(e=>{q.request("POST /markdown",{text:g.value}).then((e=>{L.classList.remove("hidden"),E.classList.add("hidden"),v.classList.remove("hidden"),g.classList.add("hidden"),v.innerHTML=e.data}))}));
